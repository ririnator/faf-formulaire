# FAF (Form-a-Friend) Production Environment Configuration
# ================================================================
# CRITICAL: This file contains production secrets. 
# Keep secure and never commit to version control.
# ================================================================

# ==================== APPLICATION CORE ====================
NODE_ENV=production
PORT=3000
HTTPS=true

# Base URLs for CORS and redirects
APP_BASE_URL=https://yourdomain.com
FRONTEND_URL=https://yourdomain.com

# Domain configuration for cookies (use .yourdomain.com for subdomains)
COOKIE_DOMAIN=yourdomain.com

# ==================== DATABASE CONFIGURATION ====================
# MongoDB Atlas or production MongoDB instance
MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/faf_production?retryWrites=true&w=majority

# Alternative for self-hosted MongoDB
# MONGODB_URI=mongodb://mongodb-user:mongodb-password@localhost:27017/faf_production?authSource=admin

# ==================== SECURITY & AUTHENTICATION ====================
# Session encryption key (generate with: openssl rand -hex 32)
SESSION_SECRET=your-super-secure-session-secret-here-64-chars-minimum

# Admin credentials (hash password with bcrypt before setting)
LOGIN_ADMIN_USER=admin
LOGIN_ADMIN_PASS=$2b$10$hashedpasswordhere
FORM_ADMIN_NAME=admin

# ==================== CLOUDINARY CONFIGURATION ====================
# Image upload and management service
CLOUDINARY_CLOUD_NAME=your-cloudinary-cloud-name
CLOUDINARY_API_KEY=your-cloudinary-api-key
CLOUDINARY_API_SECRET=your-cloudinary-api-secret

# ==================== EMAIL SERVICE CONFIGURATION ====================
# Primary email service (Resend recommended)
RESEND_API_KEY=re_your-resend-api-key

# Alternative email service (Postmark)
POSTMARK_API_KEY=your-postmark-api-key

# Email configuration
EMAIL_FROM_ADDRESS=noreply@yourdomain.com
EMAIL_FROM_NAME=Form-a-Friend
EMAIL_BATCH_SIZE=50
EMAIL_RATE_LIMIT_PER_MINUTE=100
EMAIL_WEBHOOK_SECRET=your-webhook-secret
EMAIL_TEMPLATE_CACHE_TTL=600000

# Email monitoring thresholds
EMAIL_BOUNCE_RATE_THRESHOLD=0.05
EMAIL_COMPLAINT_RATE_THRESHOLD=0.01
EMAIL_DELIVERABILITY_THRESHOLD=0.95
EMAIL_MONITORING_INTERVAL=300000
EMAIL_ALERT_COOLDOWN=3600000
EMAIL_MAX_BOUNCE_COUNT=10
EMAIL_REPUTATION_WINDOW=86400000
ENABLE_EMAIL_MONITORING=true

# Email domain validation
EMAIL_DOMAIN_WHITELIST=gmail.com,outlook.com,yahoo.com,hotmail.com
EMAIL_DOMAIN_BLACKLIST=10minutemail.com,tempmail.org
EMAIL_MX_VALIDATION=true
EMAIL_DISPOSABLE_CHECK=true
EMAIL_SUSPICIOUS_PATTERN_CHECK=true
EMAIL_LOG_BLOCKED=true

# ==================== SCHEDULER SERVICE ====================
# Monthly job scheduling
SCHEDULER_MONTHLY_JOB_DAY=5
SCHEDULER_MONTHLY_JOB_HOUR=18
SCHEDULER_TIMEZONE=Europe/Paris

# Performance limits
SCHEDULER_BATCH_SIZE=50
SCHEDULER_INVITATION_BATCH_SIZE=100
SCHEDULER_MAX_WORKERS=4
SCHEDULER_WORKER_TIMEOUT=300000
SCHEDULER_MAX_MEMORY_MB=512
SCHEDULER_MAX_JOB_DURATION_HOURS=1

# Reminder settings
SCHEDULER_FIRST_REMINDER_DAYS=3
SCHEDULER_SECOND_REMINDER_DAYS=7
SCHEDULER_EXPIRED_TOKEN_RETENTION_DAYS=90
SCHEDULER_METRICS_RETENTION_HOURS=72
SCHEDULER_ERROR_RATE_THRESHOLD=0.05
SCHEDULER_MEMORY_ALERT_THRESHOLD=0.8

# ==================== SERVICE LIMITS ====================
# Contact service
CONTACT_MAX_CSV_SIZE=5242880
CONTACT_MAX_BATCH_SIZE=100
CONTACT_MAX_TAGS=10

# Invitation service
INVITATION_TOKEN_LENGTH=32
INVITATION_EXPIRATION_DAYS=60
INVITATION_MAX_IP_CHANGES=3

# Submission service
SUBMISSION_MAX_TEXT_RESPONSES=8
SUBMISSION_MAX_PHOTO_RESPONSES=5
SUBMISSION_MIN_COMPLETION_RATE=50

# Handshake service
HANDSHAKE_EXPIRATION_DAYS=30
HANDSHAKE_MAX_PENDING=50
HANDSHAKE_CLEANUP_INTERVAL_HOURS=6

# ==================== MONITORING & ALERTING ====================
# Performance monitoring
ENABLE_PERFORMANCE_MONITORING=true
METRICS_COLLECTION_INTERVAL=60000
MEMORY_ALERT_THRESHOLD=0.8
CPU_ALERT_THRESHOLD=0.8
DISK_ALERT_THRESHOLD=0.9

# Database monitoring
DB_PERFORMANCE_MONITORING=true
DB_SLOW_QUERY_THRESHOLD=1000
DB_CONNECTION_POOL_SIZE=10
DB_MAX_IDLE_TIME=30000

# Security monitoring
ENABLE_SECURITY_MONITORING=true
FAILED_LOGIN_THRESHOLD=5
IP_BLOCK_DURATION=900000
SUSPICIOUS_ACTIVITY_ALERT=true

# ==================== LOGGING CONFIGURATION ====================
LOG_LEVEL=info
LOG_FORMAT=json
LOG_FILE_PATH=/var/log/faf/app.log
LOG_MAX_SIZE=100MB
LOG_MAX_FILES=10
ENABLE_ACCESS_LOGS=true
ENABLE_ERROR_LOGS=true

# ==================== SSL/TLS CONFIGURATION ====================
# SSL certificate paths (for self-managed certificates)
SSL_CERT_PATH=/etc/ssl/certs/yourdomain.com.crt
SSL_KEY_PATH=/etc/ssl/private/yourdomain.com.key
SSL_CA_PATH=/etc/ssl/certs/ca-certificates.crt

# Let's Encrypt configuration (if using automated certificates)
LETSENCRYPT_EMAIL=admin@yourdomain.com
LETSENCRYPT_DOMAINS=yourdomain.com,www.yourdomain.com

# ==================== BACKUP CONFIGURATION ====================
# MongoDB backup settings
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *
BACKUP_RETENTION_DAYS=30
BACKUP_STORAGE_PATH=/var/backups/faf
BACKUP_ENCRYPTION_KEY=your-backup-encryption-key

# Cloud backup (optional)
AWS_ACCESS_KEY_ID=your-aws-access-key
AWS_SECRET_ACCESS_KEY=your-aws-secret-key
AWS_S3_BUCKET=faf-backups
AWS_REGION=eu-west-1

# ==================== LOAD BALANCER & PROXY ====================
# If using load balancer or reverse proxy
TRUST_PROXY=true
PROXY_COUNT=1
RATE_LIMIT_SKIP_SUCCESSFUL_REQUESTS=true
RATE_LIMIT_SKIP_FAILED_REQUESTS=false

# ==================== MAINTENANCE MODE ====================
MAINTENANCE_MODE=false
MAINTENANCE_MESSAGE=The site is temporarily unavailable for maintenance.
MAINTENANCE_ALLOWED_IPS=127.0.0.1,::1

# ==================== FEATURE FLAGS ====================
FEATURE_ADVANCED_ANALYTICS=true
FEATURE_REAL_TIME_MONITORING=true
FEATURE_AUTO_SCALING=false
FEATURE_CDN_INTEGRATION=true

# ==================== THIRD-PARTY INTEGRATIONS ====================
# Analytics (optional)
GOOGLE_ANALYTICS_ID=GA-XXXXXXXXX
MIXPANEL_TOKEN=your-mixpanel-token

# Error tracking (optional)
SENTRY_DSN=https://your-sentry-dsn

# CDN Configuration (optional)
CDN_URL=https://cdn.yourdomain.com
CDN_ENABLED=true

# ==================== ENVIRONMENT VERIFICATION ====================
# This should match your deployment environment
DEPLOYMENT_ENVIRONMENT=production
DEPLOYMENT_VERSION=2.0.0
LAST_UPDATED=2025-08-17