<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Soumission Formulaire FAF</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; max-width: 800px; }
    .test-section { border: 1px solid #ddd; padding: 20px; margin: 20px 0; border-radius: 5px; }
    .success { background-color: #d4edda; border-color: #c3e6cb; }
    .error { background-color: #f8d7da; border-color: #f5c6cb; }
    .info { background-color: #e3f2fd; border-color: #bbdefb; }
    button { padding: 10px 20px; margin: 10px; cursor: pointer; }
    pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    input, textarea { width: 100%; padding: 8px; margin: 5px 0; box-sizing: border-box; }
  </style>
</head>
<body>
  <h1>ğŸ§ª Test de Soumission du Formulaire FAF</h1>
  
  <div class="test-section info">
    <h2>ğŸ“‹ Instructions de Test</h2>
    <p>Cette page permet de tester la soumission du formulaire sans serveur backend complet.</p>
    <p><strong>Ã‰tat du serveur:</strong> <span id="server-status">â“ VÃ©rification...</span></p>
  </div>

  <div class="test-section">
    <h2>ğŸ¯ Test 1: Validation CÃ´tÃ© Client</h2>
    <p>Test des validations avant soumission (nom vide, radio non sÃ©lectionnÃ©, etc.)</p>
    
    <form id="testForm1">
      <input type="text" name="website" style="display:none" tabindex="-1" autocomplete="off">
      
      <div>
        <label for="testName">Nom:</label>
        <input type="text" id="testName" name="name" placeholder="Laissez vide pour tester la validation">
      </div>
      
      <div>
        <label>Comment Ã§a va ?</label>
        <input type="radio" name="question1" id="testOp1" value="Ã§a va"> <label for="testOp1">Ã§a va</label>
        <input type="radio" name="question1" id="testOp2" value="gÃ©nial"> <label for="testOp2">gÃ©nial</label>
      </div>
      
      <div>
        <label for="testQ2">DÃ©tails:</label>
        <input type="text" id="testQ2" name="question2" placeholder="RÃ©ponse optionnelle">
      </div>
      
      <button type="button" onclick="testValidation()">ğŸ§ª Tester Validation</button>
    </form>
    
    <div id="validationResult"></div>
  </div>

  <div class="test-section">
    <h2>ğŸŒ Test 2: Soumission API</h2>
    <p>Test de soumission vers l'API backend</p>
    
    <form id="testForm2">
      <div>
        <label for="apiName">Nom:</label>
        <input type="text" id="apiName" name="name" value="Test User" required>
      </div>
      
      <div>
        <label>Comment Ã§a va ?</label>
        <input type="radio" name="question1" id="apiOp1" value="Ã§a va" checked> <label for="apiOp1">Ã§a va</label>
        <input type="radio" name="question1" id="apiOp2" value="gÃ©nial"> <label for="apiOp2">gÃ©nial</label>
      </div>
      
      <div>
        <label for="apiQ2">DÃ©tails:</label>
        <input type="text" id="apiQ2" name="question2" value="Test de soumission via API" required>
      </div>
      
      <button type="button" onclick="testAPISubmission()">ğŸš€ Tester API</button>
    </form>
    
    <div id="apiResult"></div>
  </div>

  <div class="test-section">
    <h2>ğŸ“ Test 3: Upload de Fichiers</h2>
    <p>Test de l'upload d'images (mock)</p>
    
    <div>
      <label for="testFile">SÃ©lectionner une image:</label>
      <input type="file" id="testFile" accept="image/*">
      <button type="button" onclick="testFileUpload()">ğŸ“ Tester Upload</button>
    </div>
    
    <div id="uploadResult"></div>
  </div>

  <div class="test-section">
    <h2>ğŸ“Š Logs de Test</h2>
    <pre id="testLogs">Logs d'activitÃ© apparaÃ®tront ici...\n</pre>
    <button onclick="clearLogs()">ğŸ—‘ï¸ Vider les logs</button>
  </div>

  <script>
    let logArea = document.getElementById('testLogs');
    
    function log(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      const prefix = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : 'â„¹ï¸';
      logArea.textContent += `[${timestamp}] ${prefix} ${message}\n`;
      logArea.scrollTop = logArea.scrollHeight;
    }
    
    function clearLogs() {
      logArea.textContent = '';
    }
    
    // Test de la validation cÃ´tÃ© client
    function testValidation() {
      log('ğŸ§ª DÃ©but du test de validation');
      
      const name = document.getElementById('testName').value.trim();
      const radio = document.querySelector('input[name="question1"]:checked');
      const q2 = document.getElementById('testQ2').value.trim();
      
      let errors = [];
      
      if (!name) errors.push('Nom manquant');
      if (name && name.length < 2) errors.push('Nom trop court (< 2 caractÃ¨res)');
      if (!radio) errors.push('Aucune option sÃ©lectionnÃ©e');
      
      const resultDiv = document.getElementById('validationResult');
      
      if (errors.length > 0) {
        resultDiv.innerHTML = `<div class="error"><strong>âŒ Erreurs de validation:</strong><ul>${errors.map(e => `<li>${e}</li>`).join('')}</ul></div>`;
        log(`Validation Ã©chouÃ©e: ${errors.join(', ')}`, 'error');
      } else {
        resultDiv.innerHTML = `<div class="success"><strong>âœ… Validation rÃ©ussie!</strong><br>Nom: "${name}"<br>RÃ©ponse: "${radio.value}"<br>DÃ©tails: "${q2}"</div>`;
        log(`Validation rÃ©ussie pour "${name}"`, 'success');
      }
    }
    
    // Test de soumission API
    async function testAPISubmission() {
      log('ğŸš€ DÃ©but du test API');
      
      const name = document.getElementById('apiName').value;
      const radio = document.querySelector('input[name="question1"]:checked');
      const q2 = document.getElementById('apiQ2').value;
      
      const data = {
        name: name,
        responses: [
          { question: 'En rapide, comment Ã§a va ?', answer: radio ? radio.value : '' },
          { question: 'DÃ©tails supplÃ©mentaires', answer: q2 }
        ]
      };
      
      log(`Envoi vers /api/response: ${JSON.stringify(data)}`);
      
      try {
        const response = await fetch('/api/response', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        const resultDiv = document.getElementById('apiResult');
        
        if (response.ok) {
          resultDiv.innerHTML = `<div class="success"><strong>âœ… Soumission rÃ©ussie!</strong><br>Message: ${result.message}<br>Lien: ${result.link || 'Aucun'}</div>`;
          log(`API Success: ${result.message}`, 'success');
        } else {
          resultDiv.innerHTML = `<div class="error"><strong>âŒ Erreur API (${response.status}):</strong><br>${result.message}</div>`;
          log(`API Error ${response.status}: ${result.message}`, 'error');
        }
        
      } catch (error) {
        document.getElementById('apiResult').innerHTML = `<div class="error"><strong>âŒ Erreur rÃ©seau:</strong><br>${error.message}</div>`;
        log(`Erreur rÃ©seau: ${error.message}`, 'error');
      }
    }
    
    // Test d'upload de fichiers (mock)
    async function testFileUpload() {
      log('ğŸ“ DÃ©but du test upload');
      
      const fileInput = document.getElementById('testFile');
      const file = fileInput.files[0];
      
      if (!file) {
        document.getElementById('uploadResult').innerHTML = `<div class="error"><strong>âŒ Aucun fichier sÃ©lectionnÃ©</strong></div>`;
        log('Upload Ã©chouÃ©: aucun fichier', 'error');
        return;
      }
      
      log(`Fichier sÃ©lectionnÃ©: ${file.name} (${file.size} bytes, ${file.type})`);
      
      const formData = new FormData();
      formData.append('image', file);
      
      try {
        const response = await fetch('/api/upload', {
          method: 'POST',
          body: formData
        });
        
        const result = await response.json();
        
        const resultDiv = document.getElementById('uploadResult');
        
        if (response.ok) {
          resultDiv.innerHTML = `<div class="success"><strong>âœ… Upload rÃ©ussi!</strong><br>URL: ${result.url}</div>`;
          log(`Upload rÃ©ussi: ${result.url}`, 'success');
        } else {
          resultDiv.innerHTML = `<div class="error"><strong>âŒ Erreur upload (${response.status}):</strong><br>${result.error || result.message}</div>`;
          log(`Upload Error ${response.status}: ${result.error || result.message}`, 'error');
        }
        
      } catch (error) {
        document.getElementById('uploadResult').innerHTML = `<div class="error"><strong>âŒ Erreur rÃ©seau:</strong><br>${error.message}</div>`;
        log(`Erreur upload: ${error.message}`, 'error');
      }
    }
    
    // VÃ©rification du statut du serveur
    async function checkServerStatus() {
      try {
        const response = await fetch('/api/response', { method: 'HEAD' });
        document.getElementById('server-status').innerHTML = 'âœ… Serveur accessible';
        log('Serveur backend accessible', 'success');
      } catch (error) {
        document.getElementById('server-status').innerHTML = 'âŒ Serveur inaccessible';
        log('Serveur backend inaccessible - tests API dÃ©sactivÃ©s', 'error');
      }
    }
    
    // Initialisation
    document.addEventListener('DOMContentLoaded', () => {
      log('ğŸ Page de test initialisÃ©e');
      checkServerStatus();
    });
  </script>
</body>
</html>